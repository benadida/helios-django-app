{% extends TEMPLATE_BASE %}


{% if admin_p %}
{% block admin %}
{% if election.frozen_at %}
{% else %}
<b>Election under Construction</b>
{% endif %}

<ul>
<li> Registration 
<b>{{ election.registration_status_pretty }}</b>
{% if not election.frozen_at %}
{% if election.openreg %}
[<a href="{% url helios.views.one_election_set_reg election.uuid %}?open_p=0">turn off</a>]
{% else %}
[<a href="{% url helios.views.one_election_set_reg election.uuid %}?open_p=1">turn on</a>]
{% endif %}
{% endif %}
</li>

{% if not election.frozen_at %}
<li> <a href="{% url helios.views.one_election_build election_id=election.uuid %}">questions and answers</a></li>
<li> <a href="{% url helios.views.list_trustees_view election.uuid %}">trustees</a></li>
<li> <a href="{% url helios.views.voters_manage election_id=election.uuid %}">manage voters</a></li>
<li> <a href="{% url helios.views.one_election_freeze election_id=election.uuid %}"><em>freeze</em> ballot and<br />open election for voting.</a></li>
{% else %}

{% ifequal election.tally_type "homomorphic" %}

{% if election.encrypted_tally %}

{% if election.result %}
<b>election tallied</b>
{% else %}
{% if election.ready_for_decryption_combination %}
<li> <a href="{% url helios.views.combine_decryptions election.uuid %}">combine decryptions</a></li>
{% else %}
<li> <a href="{% url helios.views.list_trustees_view election.uuid %}">trustees (for decryption)</a></li>
{% endif %}
{% endif %}

{% else %}

{% if email_voters %}
<li> <a href="{% url helios.views.voters_email election_id=election.uuid %}">email voters</a></li>
{% endif %}
<li> <a href="{% url helios.views.one_election_compute_tally election_id=election.uuid %}">compute tally</a></li>

{% endif %}

{% else %}
<li> custom tally</li>
{% endifequal %}



{% endif %}

</ul>
{% endblock %}
{% endif %}

{% block content %}
  <h2 class="title">{{ election.name }}</h2>
<p style="padding-top:0; margin-top:2px">
  {% if election.admin.info.name %}
an election created by <u><b>{{election.admin.info.name}}</b></u>
{% if election.questions %}
    consisting of {{election.questions|length}} questions.
{% else %}
    , no questions yet.
{% endif %}

</p>
{% endif %}

<div style="margin-bottom: 25px;">
<span style="padding:0px; margin:0px; font-size:1.5em; ">
"{{election.description}}"
</span>
<br />
{{election.questions|length}} question(s).
</div>

{% if election.result %}
<div class="highlight-box">
    This election is complete. The tally is just below.
    Check the <a href="#audit">auditing information</a>.
</div>

<h3>Tally</h3>
{% for question in election.pretty_result %}
<b>{{question.question}}</b>:
<ul>
{% for answer in question.answers %}
<li> {{answer.answer}}: {{answer.count}}
{% endfor %}
</ul>
{% endfor %}

{% else %}

{% if election.frozen_at %}
<span class="highlight-box round" style="font-size: 1.6em; margin-right: 10px;">
<a href="/booth/vote.html?election_url={% url helios.views.one_election election.uuid %}">Vote in this election </a>
</span><br /><br />
{% endif %}

{% if user %}
{% if voter %}
<p style="padding-top:5px;">You are registered to vote in this election.
{% if election.use_voter_aliases %}
Your voter alias is {{voter.alias}}.
{% endif %}
</p>

{% else %}
You ({{user.user_id}}) are <em>not</em> registered<br /> to vote in this election.<br />
{% if election.result %}
{% else %}
{% if election.openreg %}
<form method="post" action="{% url helios.views.one_election_register election.uuid %}">
<input type="hidden" name="csrf_token" value="{{csrf_token}}" />
<input type="submit" value="register!" />
</form>
{% endif %}
{% endif %}
{% endif %}
{% else %}

For your privacy, you'll be asked to log in only once your ballot is encrypted.
{% endif %}

{% endif %}

<br clear="left" />

<div style="background: lightyellow; padding:5px; padding-left: 10px; margin-top: 15px; border: 1px solid #aaa; width: 780px;" class="round">
<div style="float:right; padding: 5px;">
    <a href="#">What's this?</a>
</div>
<h3 id="audit" name="audit">Audit Information</h3>
<tt style="font-size: 1.2em;">{{election.url}}</tt>

{% if election.frozen_at %}
<br />
<br />Election Fingerprint: <tt style="font-size: 1.3em; font-weight: bold;">{{election.hash}}</tt>


{% if votes %}
<p>Your last cast ballot at <span class="date_prettify">{{votes.0.cast_at}}</span><br />
<tt style="font-size:14pt; font-weight: bold;">{{votes.0.vote_hash}}</tt>
</p>
{% endif %}

<p style="font-size: 1.3em;">
<a href="{% url helios.views.one_election_bboard election.uuid %}">all cast votes</a>
</p>

<p>
Trustees: 
{% for t in trustees %}
{{t.name}}&nbsp;&nbsp;
{% endfor %}
[<a href="{% url helios.views.list_trustees_view election.uuid %}">more info</a>]
</p>
    
{% endif %}

{% if election.result %}
<p style="font-size: 1.2em;">
{% ifequal election.tally_type "homomorphic" %}
perform <a target="_blank" href="/verifier/verify.html?election_url={% url helios.views.one_election election.uuid %}">election tally</a>.
{% else %}
<b>This election uses a custom tallying mechanism, which must be audited by the custom code.</b>
{% endifequal %}

review the <a href="/booth/vote.html?election_url={% url helios.views.one_election election.uuid %}">voting booth</a>.
</p>

{% endif %}
</div>




{% endblock %}