{% extends TEMPLATE_BASE %}

{% block content %}
  <h2 class="title">{{ election.name }}</h2>

{% if admin_p %}

<div style="float:right; border-left: 1px dashed black; padding: 0px 20px 5px 20px;">
<h3>Administration</h3>
{% if election.frozen_at %}
<b>Election in Progress</b>
{% else %}
<b>Election under Construction</b>
{% endif %}

<ul>

{% if not election.frozen_at %}
<li> <a href="{% url helios.views.one_election_build election_id=election.uuid %}">questions and answers</a></li>
<li> <a href="{% url helios.views.list_trustees_view election.uuid %}">trustees</a></li>
<li> <a href="{% url helios.views.voters_manage election_id=election.uuid %}">manage voters</a></li>
<li> <a href="{% url helios.views.one_election_freeze election_id=election.uuid %}"><em>freeze</em> election and start voting.</a></li>
{% else %}

{% ifequal election.tally_type "homomorphic" %}

{% if election.encrypted_tally %}

{% if election.result %}
<b>election tallied</b>
{% else %}
{% if election.ready_for_decryption_combination %}
<li> <a href="{% url helios.views.combine_decryptions election.uuid %}">combine decryptions</a></li>
{% else %}
<li> <a href="{% url helios.views.list_trustees_view election.uuid %}">trustees (for decryption)</a></li>
{% endif %}
{% endif %}

{% else %}

<li> <a href="{% url helios.views.voters_email election_id=election.uuid %}">email voters</a></li>
<li> <a href="{% url helios.views.one_election_compute_tally election_id=election.uuid %}">compute tally</a></li>

{% endif %}

{% else %}
<li> custom tally</li>
{% endifequal %}



{% endif %}

</ul>
</div>
{% endif %}

{% if election.frozen_at %}

<div id="election_info">
<p>Election ID<br />
<b><tt>{{election.uuid}}</tt></b><br /><br />

Election Fingerprint<br />
<b><tt>{{election.hash}}</tt></b></p>
</div>
{% endif %}

{% if election.self_registration %}
{% if user %}
{% if voter %}
<p>You ({{user.user_id}}) are registered to vote in this election.
{% if election.use_voter_aliases %}
Your voter alias is {{voter.alias}}.
{% endif %}
</p>

{% else %}
You ({{user.user_id}}) are <em>not</em> registered to vote in this election.<br />
{% if election.result %}
{% else %}
<form method="post" action="{% url helios.views.one_election_register election.uuid %}">
<input type="hidden" name="csrf_token" value="{{csrf_token}}" />
<input type="submit" value="register!" />
</form>
{% endif %}
{% endif %}
{% else %}
not logged in.
{% endif %}
{% endif %}

{% if election.frozen_at %}
{% if votes %}
<p>You ({{user.user_id}}) have cast a vote in this election:<br />
<tt style="font-size:14pt; font-weight: bold;">{{votes.0.vote_hash}}</tt><br />
at {{votes.0.cast_at}}.
</p>
{% endif %}

<p ><a style="font-size: 18pt;" href="/booth/vote.html?election_url={% url helios.views.one_election election.uuid %}">Vote in this election</a><br />
{% if election.result %}
[the tally has already been computed, but you can view the voting interface anyways]
{% else %}
{% if votes %}
[the new vote will replace the old]
{% endif %}

{% if election.self_registration %}
{% if notregistered %}
[you are not registered for this election, so you won't be able to cast a vote]
{% endif %}
{% endif %}

{% endif %}

{% else %}
<p><em>This election is not ready for voting yet.</em><br />
{% endif %}


{% if election.frozen_at %}
<p>
<a href="{% url helios.views.one_election_bboard election.uuid %}" style="font-size:18pt;">Bulletin Board</a>
|
<a href="{% url helios.views.list_trustees_view election.uuid %}" style="font-size:18pt;">Trustees</a>
</p>
{% endif %}

{%if election.result %}
<h2>Tally</h2>
{% for question in election.pretty_result %}
<b>{{question.question}}</b>:
<ul>
{% for answer in question.answers %}
<li> {{answer.answer}}: {{answer.count}}
{% endfor %}
</ul>
{% endfor %}

{% ifequal election.tally_type "homomorphic" %}
<a style="font-size: 14pt;" target="_blank" href="/verifier/verify.html?election_url={% url helios.views.one_election election.uuid %}">Audit the Election Tally</a><br />
{% else %}
<b>This election uses a custom tallying mechanism, which must be audited by the custom code.</b>
{% endifequal %}

<br /><br />
{% endif %}

{% endblock %}