{% extends TEMPLATE_BASE %}
{% block title %}Confirm Vote{% endblock %}

{% block content %}
<script language="javascript">
$(document).ready(function() {
  $('#waiting_div').hide();
});

function show_waiting() {
  $('#cast_form').hide();
  $('#waiting_div').show();
}
</script>
<h1>{{election.name}} &mdash; Submit your Vote</h1>

<p>
    <b><em>HOLD ON!</em></b> You're not quite done yet.
</p>

<p>
    Now that your ballot is encrypted, you need to log in so we can ensure you are eligible for this election,<br />
    then cast your ballot so we can confirm it is properly formed.
</p>

<p>
  We have received your encrypted ballot with tracking number:<br /><br />
    <tt style="font-size:1.8em; font-weight: bold; padding-left: 20px;">  {{vote_fingerprint}}</tt>
</p>

{% if user %}
<p>
  You are logged in as: <br/>
<span style="font-size: 1.4em;">
    {{user.user_id}}</span><br />
    (<a href="{% url auth.views.logout %}?return_url={{CURRENT_URL}}">switch user</a>)
</p>

{% if voter %}
{% if past_votes %}
<!--
<h3>Past Votes Cast for this Election</h3>
<ul>
{% for vote in past_votes %}
<li> <tt>{{vote.vote_hash}}</tt></li>
{% endfor %}
</ul>
-->
{% else %}
<!--<em>no vote cast yet</em>-->
{% endif %}

<br />
{% if election.voting_has_started %}
{% if not election.voting_has_stopped %}
<br />
<div id="cast_form">
<form method="post" action="" onsubmit="show_waiting()">
    <input type="hidden" name="csrf_token" value="{{csrf_token}}" />
    
    <input type="submit" value="cast this ballot" style="font-size: 1.5em;" />
    <span style="font-size:0.8em;"><br />You can cast as many ballots as you want.<br />Only the last one counts.</span>
</form>

<p>
    <button style="font-size: 1.5em;" onclick="document.location='./view';">cancel</button><br />
    <span style="font-size:0.8em;">If you cancel now, your ballot will <em>NOT</em> be recorded.<br />
    You can start the voting process over again, of course.</span>
</p>

</div>
<div id="waiting_div">
    Verifying and Casting your ballot<br />
    <img src="/static/helios/loading.gif" />
</div>
{% else %}
<p style="font-size:1.4em;">
  voting has stopped, sorry.
</p>
{% endif %}
{% else %}
<p style="font-size:1.4em;">
  voting has not yet begun, sorry.
</p>
{% endif %}
{% else %}
<p>
{% if election.openreg %}
<b>Sorry, you are <em><u>not eligible</u></em> for this election.</b><br />
{% else %}
<b>Sorry, you are <em>not registered</em> for this election, and registration is closed.</b><br />
{% endif %}
</p>
<p>
    [<a href="{% url helios.views.one_election_view election.uuid %}">return to the main election page</a>]
</p>
{% endif %}

{% else %}
<br />
<form method="get" action="{% url auth.views.index %}">
    <input type="hidden" name="return_url" value="{% url helios.views.one_election_cast_confirm election.uuid %}">
    <input type="submit" class="pretty" style="font-size: 1.6em;" value="Log In" />
</form>
<br />
Don't worry, you can go log in without losing your ballot.
{% endif %}
{% endblock %}
